<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>트레이딩 일지 - Trading Journal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="css/dashboard-glass.css">
    <style>
        /* Journal-specific styles extending glassmorphism */

        /* Date Navigation */
        .date-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-5);
        }
        .current-date {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--text-primary);
            font-family: var(--font-mono);
        }
        .day-of-week {
            font-size: var(--font-size-base);
            color: var(--text-muted);
            margin-left: var(--space-2);
        }

        /* Emotion Selector */
        .emotion-selector {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
        }
        .emotion-btn {
            padding: var(--space-2) var(--space-4);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-full);
            background: var(--glass-bg);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition-base);
            font-size: var(--font-size-sm);
            font-weight: 500;
        }
        .emotion-btn:hover {
            border-color: var(--gradient-start);
            background: var(--glass-bg-hover);
            transform: translateY(-2px);
        }
        .emotion-btn.selected {
            border-color: var(--gradient-start);
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-mid));
            color: white;
            box-shadow: 0 4px 15px var(--color-accent-glow);
        }

        /* Score Selector */
        .score-selector {
            display: flex;
            gap: var(--space-2);
            justify-content: center;
        }
        .score-btn {
            width: 45px;
            height: 45px;
            border: 2px solid var(--glass-border);
            border-radius: 50%;
            background: var(--glass-bg);
            color: var(--text-primary);
            cursor: pointer;
            font-weight: 700;
            font-family: var(--font-mono);
            transition: var(--transition-base);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .score-btn:hover {
            border-color: var(--gradient-start);
            background: var(--glass-bg-hover);
            transform: scale(1.1);
        }
        .score-btn.selected {
            border-color: var(--gradient-start);
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-mid));
            color: white;
            box-shadow: 0 4px 15px var(--color-accent-glow);
        }

        /* Text Area */
        .journal-textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Trade Summary */
        .trade-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-3);
            text-align: center;
        }
        .summary-item {
            padding: var(--space-4);
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--radius-md);
        }
        .summary-value {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            font-family: var(--font-mono);
            color: var(--text-primary);
        }
        .summary-label {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: var(--space-1);
        }

        /* Tag Input */
        .tag-input-container {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
            padding: var(--space-3);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            background: var(--glass-bg);
            min-height: 45px;
        }
        .tag {
            display: inline-flex;
            align-items: center;
            padding: var(--space-1) var(--space-3);
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            color: var(--text-primary);
        }
        .tag .remove {
            margin-left: var(--space-2);
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition-fast);
        }
        .tag .remove:hover {
            color: var(--color-negative);
        }
        .tag-input {
            border: none;
            outline: none;
            background: transparent;
            color: var(--text-primary);
            flex: 1;
            min-width: 100px;
            font-family: var(--font-display);
        }
        .tag-input::placeholder {
            color: var(--text-muted);
        }

        /* Card Header Variants */
        .card-header-morning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .card-header-evening {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .card-header-plan {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        .card-header-review {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        .card-header-summary {
            background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
        }
        .card-header-lesson {
            background: linear-gradient(135deg, #f5af19 0%, #f12711 100%);
        }
        .card-header-tomorrow {
            background: linear-gradient(135deg, #00c6fb 0%, #005bea 100%);
        }

        /* Glass Card with Gradient Header */
        .glass-card-gradient .glass-card-header {
            color: white;
            border: none;
        }

        /* Stats Cards */
        .stats-value {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            font-family: var(--font-mono);
        }
        .stats-label {
            font-size: var(--font-size-sm);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Calendar specific overrides */
        .calendar-day.has-journal {
            background: rgba(0, 245, 160, 0.15);
            border-color: var(--color-positive);
        }
        .calendar-day.has-journal::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--color-positive);
            box-shadow: 0 0 8px var(--color-positive-glow);
        }
        .calendar-day.selected {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-mid)) !important;
            color: white !important;
        }
        .calendar-day.other-month {
            opacity: 0.3;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .date-nav {
                flex-direction: column;
                gap: var(--space-3);
            }
            .trade-summary {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Background Orbs -->
    <div class="bg-orb bg-orb-1"></div>
    <div class="bg-orb bg-orb-2"></div>
    <div class="bg-orb bg-orb-3"></div>

    <!-- Navigation -->
    <nav class="navbar-glass">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <div class="logo-icon">
                    <i class="bi bi-journal-richtext"></i>
                </div>
                <span>Trading Journal</span>
            </a>
            <ul class="navbar-nav">
                <li><a class="nav-link" href="index.html">
                    <i class="bi bi-house-door"></i>투자기록
                </a></li>
                <li><a class="nav-link" href="dashboard.html">
                    <i class="bi bi-speedometer2"></i>대시보드
                </a></li>
                <li><a class="nav-link" href="statistics.html">
                    <i class="bi bi-bar-chart"></i>통계분석
                </a></li>
                <li><a class="nav-link active" href="journal.html">
                    <i class="bi bi-journal-text"></i>일지
                </a></li>
                <li><a class="nav-link" href="patterns.html">
                    <i class="bi bi-grid-3x3-gap"></i>패턴
                </a></li>
                <li><a class="nav-link" href="backtest.html">
                    <i class="bi bi-arrow-repeat"></i>백테스트
                </a></li>
                <li><a class="nav-link" href="risk.html">
                    <i class="bi bi-shield-check"></i>리스크
                </a></li>
            </ul>
        </div>
    </nav>

    <div class="main-container">
        <!-- Date Navigation -->
        <div class="glass-card mb-6">
            <div class="glass-card-body">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--space-4);">
                    <div class="date-nav">
                        <button class="btn-glass" id="prev-day">
                            <i class="bi bi-chevron-left"></i> 이전
                        </button>
                        <div>
                            <span class="current-date" id="current-date">2025-01-18</span>
                            <span class="day-of-week" id="day-of-week">(토요일)</span>
                        </div>
                        <button class="btn-glass" id="next-day">
                            다음 <i class="bi bi-chevron-right"></i>
                        </button>
                    </div>
                    <div style="display: flex; gap: var(--space-2);">
                        <button class="btn-glass primary" id="today-btn">
                            <i class="bi bi-calendar-check"></i>오늘
                        </button>
                        <button class="btn-glass" onclick="openCalendarModal()">
                            <i class="bi bi-calendar3"></i>달력
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('write')">
                <i class="bi bi-pencil"></i> 일지 작성
            </button>
            <button class="tab-btn" onclick="switchTab('stats')">
                <i class="bi bi-graph-up"></i> 일지 통계
            </button>
            <button class="tab-btn" onclick="switchTab('history')">
                <i class="bi bi-clock-history"></i> 최근 일지
            </button>
        </div>

        <div class="tab-content">
            <!-- Write Tab -->
            <div class="tab-pane active" id="tab-write">
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--space-6);">
                    <!-- Left Column -->
                    <div>
                        <!-- Market Overview -->
                        <div class="glass-card glass-card-gradient mb-6">
                            <div class="glass-card-header">
                                <h3><i class="bi bi-graph-up-arrow"></i>시장 개요</h3>
                            </div>
                            <div class="glass-card-body">
                                <textarea class="form-input journal-textarea" id="market-overview"
                                    placeholder="오늘의 시장 상황을 기록하세요. (예: 코스피 상승, 미국 선물 강세, 특이사항 등)"></textarea>
                            </div>
                        </div>

                        <!-- Trading Plan -->
                        <div class="glass-card glass-card-gradient mb-6">
                            <div class="glass-card-header card-header-plan">
                                <h3><i class="bi bi-list-check"></i>오늘의 거래 계획</h3>
                            </div>
                            <div class="glass-card-body">
                                <textarea class="form-input journal-textarea" id="trading-plan"
                                    placeholder="오늘의 거래 계획을 기록하세요. (예: 관심 종목, 진입 조건, 손절/익절 전략 등)"></textarea>
                            </div>
                        </div>

                        <!-- Execution Review -->
                        <div class="glass-card glass-card-gradient mb-6">
                            <div class="glass-card-header card-header-review">
                                <h3><i class="bi bi-check2-square"></i>실행 리뷰</h3>
                            </div>
                            <div class="glass-card-body">
                                <textarea class="form-input journal-textarea" id="execution-review"
                                    placeholder="계획대로 실행했는지 리뷰하세요. (예: 계획 준수 여부, 즉흥적 거래, 감정적 결정 등)"></textarea>
                            </div>
                        </div>

                        <!-- Lessons Learned -->
                        <div class="glass-card glass-card-gradient mb-6">
                            <div class="glass-card-header card-header-lesson">
                                <h3><i class="bi bi-lightbulb"></i>오늘의 교훈</h3>
                            </div>
                            <div class="glass-card-body">
                                <textarea class="form-input journal-textarea" id="lessons-learned"
                                    placeholder="오늘 거래에서 배운 점을 기록하세요."></textarea>
                            </div>
                        </div>

                        <!-- Tomorrow Plan -->
                        <div class="glass-card glass-card-gradient mb-6">
                            <div class="glass-card-header card-header-tomorrow">
                                <h3><i class="bi bi-calendar-plus"></i>내일 계획</h3>
                            </div>
                            <div class="glass-card-body">
                                <textarea class="form-input journal-textarea" id="tomorrow-plan"
                                    placeholder="내일의 거래 계획이나 관심 종목을 미리 기록하세요."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div>
                        <!-- Morning Emotion -->
                        <div class="glass-card glass-card-gradient mb-6">
                            <div class="glass-card-header card-header-morning">
                                <h3><i class="bi bi-sunrise"></i>오전 감정 상태</h3>
                            </div>
                            <div class="glass-card-body">
                                <div class="emotion-selector" id="morning-emotion">
                                    <!-- Dynamically generated -->
                                </div>
                            </div>
                        </div>

                        <!-- Evening Emotion -->
                        <div class="glass-card glass-card-gradient mb-6">
                            <div class="glass-card-header card-header-evening">
                                <h3><i class="bi bi-sunset"></i>오후 감정 상태</h3>
                            </div>
                            <div class="glass-card-body">
                                <div class="emotion-selector" id="evening-emotion">
                                    <!-- Dynamically generated -->
                                </div>
                            </div>
                        </div>

                        <!-- Scores -->
                        <div class="glass-card glass-card-gradient mb-6">
                            <div class="glass-card-header">
                                <h3><i class="bi bi-star"></i>오늘의 점수</h3>
                            </div>
                            <div class="glass-card-body">
                                <div class="mb-5">
                                    <label class="form-label" style="font-weight: 600; margin-bottom: var(--space-3);">집중도</label>
                                    <div class="score-selector" id="focus-score">
                                        <button class="score-btn" data-score="1">1</button>
                                        <button class="score-btn" data-score="2">2</button>
                                        <button class="score-btn" data-score="3">3</button>
                                        <button class="score-btn" data-score="4">4</button>
                                        <button class="score-btn" data-score="5">5</button>
                                    </div>
                                </div>
                                <div>
                                    <label class="form-label" style="font-weight: 600; margin-bottom: var(--space-3);">규율 준수</label>
                                    <div class="score-selector" id="discipline-score">
                                        <button class="score-btn" data-score="1">1</button>
                                        <button class="score-btn" data-score="2">2</button>
                                        <button class="score-btn" data-score="3">3</button>
                                        <button class="score-btn" data-score="4">4</button>
                                        <button class="score-btn" data-score="5">5</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tags -->
                        <div class="glass-card glass-card-gradient mb-6">
                            <div class="glass-card-header card-header-summary">
                                <h3><i class="bi bi-tags"></i>태그</h3>
                            </div>
                            <div class="glass-card-body">
                                <div class="tag-input-container" id="tags-container">
                                    <input type="text" class="tag-input" id="tag-input" placeholder="태그 입력 후 Enter">
                                </div>
                                <small class="text-muted" style="display: block; margin-top: var(--space-2);">Enter를 눌러 태그를 추가하세요</small>
                            </div>
                        </div>

                        <!-- Today's Trade Summary -->
                        <div class="glass-card glass-card-gradient mb-6">
                            <div class="glass-card-header card-header-summary">
                                <h3><i class="bi bi-clipboard-data"></i>오늘의 거래 요약</h3>
                            </div>
                            <div class="glass-card-body">
                                <div class="trade-summary">
                                    <div class="summary-item">
                                        <div class="summary-value" id="trade-count">-</div>
                                        <div class="summary-label">거래</div>
                                    </div>
                                    <div class="summary-item">
                                        <div class="summary-value" id="trade-profit">-</div>
                                        <div class="summary-label">손익</div>
                                    </div>
                                    <div class="summary-item">
                                        <div class="summary-value" id="trade-win-rate">-</div>
                                        <div class="summary-label">승률</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Save/Delete Buttons -->
                        <div style="display: flex; flex-direction: column; gap: var(--space-3);">
                            <button class="btn-glass primary" id="save-btn" style="padding: var(--space-4) var(--space-6); font-size: var(--font-size-base);">
                                <i class="bi bi-check-circle"></i>저장
                            </button>
                            <button class="btn-glass" id="delete-btn" style="display: none; border-color: var(--color-negative); color: var(--color-negative);">
                                <i class="bi bi-trash"></i>삭제
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Tab -->
            <div class="tab-pane" id="tab-stats">
                <div class="stats-grid mb-6">
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <span class="stat-card-label">총 일지 수</span>
                            <div class="stat-card-icon"><i class="bi bi-journal-text"></i></div>
                        </div>
                        <div class="stat-card-value" id="stats-total-journals">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <span class="stat-card-label">평균 집중도</span>
                            <div class="stat-card-icon"><i class="bi bi-bullseye"></i></div>
                        </div>
                        <div class="stat-card-value" id="stats-avg-focus">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <span class="stat-card-label">평균 규율 준수</span>
                            <div class="stat-card-icon"><i class="bi bi-shield-check"></i></div>
                        </div>
                        <div class="stat-card-value" id="stats-avg-discipline">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <span class="stat-card-label">연속 작성일</span>
                            <div class="stat-card-icon"><i class="bi bi-fire"></i></div>
                        </div>
                        <div class="stat-card-value" id="stats-streak">-</div>
                    </div>
                </div>

                <div class="two-col-grid mb-6">
                    <!-- Morning Emotion Distribution -->
                    <div class="glass-card glass-card-gradient">
                        <div class="glass-card-header card-header-morning">
                            <h3><i class="bi bi-emoji-smile"></i>오전 감정 분포</h3>
                        </div>
                        <div class="glass-card-body" id="morning-emotion-stats">
                            <div class="text-center text-muted" style="padding: var(--space-8);">통계 데이터를 불러오는 중...</div>
                        </div>
                    </div>

                    <!-- Evening Emotion Distribution -->
                    <div class="glass-card glass-card-gradient">
                        <div class="glass-card-header card-header-evening">
                            <h3><i class="bi bi-emoji-smile"></i>오후 감정 분포</h3>
                        </div>
                        <div class="glass-card-body" id="evening-emotion-stats">
                            <div class="text-center text-muted" style="padding: var(--space-8);">통계 데이터를 불러오는 중...</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Lessons -->
                <div class="glass-card glass-card-gradient">
                    <div class="glass-card-header card-header-lesson">
                        <h3><i class="bi bi-lightbulb"></i>최근 교훈</h3>
                    </div>
                    <div class="glass-card-body" id="recent-lessons">
                        <div class="text-center text-muted" style="padding: var(--space-8);">데이터를 불러오는 중...</div>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div class="tab-pane" id="tab-history">
                <div class="glass-card">
                    <div class="glass-card-header">
                        <h3><i class="bi bi-clock-history"></i>최근 30일 일지</h3>
                    </div>
                    <div class="glass-card-body">
                        <div style="overflow-x: auto;">
                            <table class="glass-table">
                                <thead>
                                    <tr>
                                        <th>날짜</th>
                                        <th>오전 감정</th>
                                        <th>오후 감정</th>
                                        <th>집중도</th>
                                        <th>규율</th>
                                        <th>거래</th>
                                        <th>손익</th>
                                        <th>내용</th>
                                    </tr>
                                </thead>
                                <tbody id="journal-history">
                                    <tr>
                                        <td colspan="8" class="text-center text-muted" style="padding: var(--space-8);">데이터를 불러오는 중...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Calendar Modal -->
    <div class="modal-glass" id="calendarModal">
        <div class="modal-glass-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="bi bi-calendar3"></i>날짜 선택</h3>
                <button class="modal-close" onclick="closeCalendarModal()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-4);">
                    <button class="btn-glass" id="cal-prev-month">
                        <i class="bi bi-chevron-left"></i>
                    </button>
                    <span style="font-weight: 600; font-size: var(--font-size-lg);" id="cal-month-year">2025년 1월</span>
                    <button class="btn-glass" id="cal-next-month">
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
                <div class="calendar-grid" style="margin-bottom: var(--space-3);">
                    <div style="text-align: center; font-weight: 600; color: var(--text-muted); font-size: var(--font-size-xs); padding: var(--space-2);">일</div>
                    <div style="text-align: center; font-weight: 600; color: var(--text-muted); font-size: var(--font-size-xs); padding: var(--space-2);">월</div>
                    <div style="text-align: center; font-weight: 600; color: var(--text-muted); font-size: var(--font-size-xs); padding: var(--space-2);">화</div>
                    <div style="text-align: center; font-weight: 600; color: var(--text-muted); font-size: var(--font-size-xs); padding: var(--space-2);">수</div>
                    <div style="text-align: center; font-weight: 600; color: var(--text-muted); font-size: var(--font-size-xs); padding: var(--space-2);">목</div>
                    <div style="text-align: center; font-weight: 600; color: var(--text-muted); font-size: var(--font-size-xs); padding: var(--space-2);">금</div>
                    <div style="text-align: center; font-weight: 600; color: var(--text-muted); font-size: var(--font-size-xs); padding: var(--space-2);">토</div>
                </div>
                <div class="calendar-grid" id="calendar-days">
                    <!-- Dynamically generated -->
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js/dashboard-glass.js"></script>
    <script src="auth.js"></script>
    <script>
        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));

            event.target.closest('.tab-btn').classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');
        }

        // Calendar modal functions
        function openCalendarModal() {
            document.getElementById('calendarModal').classList.add('show');
            if (typeof journalState !== 'undefined' && typeof renderCalendar === 'function') {
                journalState.calendarDate = new Date(journalState.currentDate);
                renderCalendar();
            }
        }

        function closeCalendarModal() {
            document.getElementById('calendarModal').classList.remove('show');
        }

        // Close modal when clicking outside
        document.getElementById('calendarModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeCalendarModal();
            }
        });
    </script>
    <script src="journal.js"></script>
</body>
</html>
