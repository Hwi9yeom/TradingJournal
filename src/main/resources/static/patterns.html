<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>거래 패턴 분석 - Trading Journal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px 12px 0 0 !important;
            font-weight: 600;
        }
        .streak-positive {
            color: #28a745;
            font-weight: bold;
        }
        .streak-negative {
            color: #dc3545;
            font-weight: bold;
        }
        .stat-card {
            text-align: center;
            padding: 20px;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
        }
        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        .heatmap-cell {
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            margin: 2px;
        }
        .heatmap-positive {
            background-color: rgba(40, 167, 69, 0.2);
        }
        .heatmap-negative {
            background-color: rgba(220, 53, 69, 0.2);
        }
        .heatmap-neutral {
            background-color: rgba(108, 117, 125, 0.1);
        }
        .streak-timeline {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            padding: 10px;
        }
        .streak-block {
            width: 40px;
            height: 40px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
        }
        .streak-win {
            background-color: #28a745;
        }
        .streak-loss {
            background-color: #dc3545;
        }
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                <i class="bi bi-journal-richtext me-2"></i>Trading Journal
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="dashboard.html">대시보드</a>
                <a class="nav-link active" href="patterns.html">패턴 분석</a>
                <a class="nav-link" href="correlation.html">상관관계분석</a>
                <a class="nav-link" href="ai-assistant.html">AI어시스턴트</a>
                <a class="nav-link" href="index.html">홈</a>
            </div>
        </div>
    </nav>

    <div class="container py-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="bi bi-bar-chart-steps me-2"></i>거래 패턴 분석</h2>
            <div class="d-flex gap-2">
                <input type="date" class="form-control" id="startDate">
                <input type="date" class="form-control" id="endDate">
                <button class="btn btn-primary" id="btnAnalyze">
                    <i class="bi bi-search me-1"></i>분석
                </button>
            </div>
        </div>

        <!-- 요약 카드 -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="stat-value" id="totalTrades">-</div>
                    <div class="stat-label">총 거래 수</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="stat-value" id="currentStreak">-</div>
                    <div class="stat-label">현재 스트릭</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="stat-value streak-positive" id="maxWinStreak">-</div>
                    <div class="stat-label">최대 연승</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="stat-value streak-negative" id="maxLossStreak">-</div>
                    <div class="stat-label">최대 연패</div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- 연승/연패 타임라인 -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <i class="bi bi-lightning me-2"></i>연승/연패 타임라인
                    </div>
                    <div class="card-body">
                        <div class="streak-timeline" id="streakTimeline">
                            <div class="text-muted">데이터를 불러오는 중...</div>
                        </div>
                        <div class="mt-3 d-flex gap-3">
                            <small><span class="badge bg-success">녹색</span> 연승</small>
                            <small><span class="badge bg-danger">빨강</span> 연패</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 요일별 성과 -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <i class="bi bi-calendar-week me-2"></i>요일별 성과
                    </div>
                    <div class="card-body">
                        <canvas id="dayOfWeekChart" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- 월별 계절성 -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <i class="bi bi-calendar3 me-2"></i>월별 계절성
                    </div>
                    <div class="card-body">
                        <canvas id="monthlyChart" height="150"></canvas>
                    </div>
                </div>
            </div>

            <!-- 보유 기간 분석 -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <i class="bi bi-clock-history me-2"></i>보유 기간 분석
                    </div>
                    <div class="card-body">
                        <div id="holdingPeriodStats">
                            <div class="mb-3">
                                <div class="progress-label">
                                    <span>평균 보유 기간</span>
                                    <span id="avgHoldingDays">- 일</span>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="progress-label">
                                    <span>수익 거래 평균</span>
                                    <span id="avgWinHoldingDays" class="text-success">- 일</span>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="progress-label">
                                    <span>손실 거래 평균</span>
                                    <span id="avgLossHoldingDays" class="text-danger">- 일</span>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <canvas id="holdingPeriodChart" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- 거래 규모 분석 -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <i class="bi bi-cash-stack me-2"></i>거래 규모 분석
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-6">
                                <small class="text-muted">평균 거래금액</small>
                                <div class="fw-bold" id="avgTradeAmount">-</div>
                            </div>
                            <div class="col-6">
                                <small class="text-muted">표준편차</small>
                                <div class="fw-bold" id="stdDeviation">-</div>
                            </div>
                        </div>
                        <canvas id="tradeSizeChart" height="200"></canvas>
                    </div>
                </div>
            </div>

            <!-- 거래 규모별 승률 -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <i class="bi bi-trophy me-2"></i>거래 규모별 성과
                    </div>
                    <div class="card-body">
                        <div id="tradeSizePerformance">
                            <div class="text-muted">데이터를 불러오는 중...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="patterns.js"></script>
</body>
</html>
